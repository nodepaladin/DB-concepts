## **Redis**
### 1.存储数据类型
### String List Set sortSet hash HyperLogLog  
### 2.事务
一系列操作可以合并为一个事务，要么都执行要么都不执行，Redis事务不会回滚
事务通过MULTI开启，之后的语句被看做事务的一部分，通过EXEC执行事务。
### 3.持久化
Redis可以将内存中的数据持久化到硬盘上，便于备份、容灾等
### RDB：在指定时间间隔内生成当时时间点的数据集快照
    优点：1）RDB数据快照是一个非常紧凑的文件，非常适合数据备份。可以设置最近24小时每小时备份一次RDB文件的
         同时再设置一天/一周/一月备份一次，数据恢复的时候可以恢复到某一时间节点的数据。
         2）RDB非常适合灾难恢复，只有一个紧凑的文件，加密后传输到别的数据中心恢复即可
         3）RDB文件在恢复的时候不会影响Redis父进程，父进程只需要fork一个子进程，子进程会将RDB文件恢复为数据
         4）RDB恢复数据效率比AOF高
    缺点：1）由于RDB快照是有时间间隔的，因此在Redis发生故障的时候可能会丢失某个时间段的数据。介于生成RDB文件对于性能
         的损耗以及业务意义，这个间隔不太可能到秒级别。因此如果要尽量避免在服务器故障时丢失数据，RDB可能不太适用。
         2）每次保存RDB的时候，父进程都需要fork出一个子进程来做这件事，当数据量很大的时候这个fork可能会很耗时。甚至
         达到一秒。这时候Redis父进程会被阻塞无法处理客户端请求。
### AOF：appendonly file
    优点：1）AOF有多种同步策略可以设置，比如无需同步，按秒同步（默认策略），每次有写入执行的时候同步等。即便是按秒同步，
         对Redis的性能也不会产生大的影响。
         2）AOF的记录是一个文件追加的过程，并不需要seek文件内容，即便是文件中有发生故障之类的情况写入的不完整语句，通过
         redis-check-aof也能将这些情况轻松修复。
         3）当AOF文件变得足够大的时候，Redis会对AOF进行重写，重写后的AOF文件只保留恢复当前数据的最小命令集合。重写过程
         非常安全，Redis在创建新文件的时候仍然对旧文件进行写入，即便发生故障，旧的AOF文件也不会丢失。当新文件创建完毕后，
         Redis会从旧文件切换到新文件，继续在新文件追加写入。
         4）AOF有序的保存了对Redis的所有写入操作。并以Redis协议的格式保存，这种格式非常易读和导出。如果不小心FLUSHALL了
         Redis的数据，只需要将服务停下来，把AOF文件中最后一行FLUSHALL删掉，重启Redis即可恢复到之前的数据状态。
    缺点：1）同等的数据集AOF文件体积一般比RDB文件大，因为RDB格式更为紧凑
         2）根据文件同步策略fsync，一般情况下fsync按秒同步Redis仍有很好的效率。但是RDB在业务并发很高的情况下显然效率更高。
         3）AOF某些情况下的数据库恢复会有差异，RDB不会出现这种情况。
### 对应几个问题
> ### RDB和AOF的选择？ 
如果业务允许几分钟的数据丢失，可以采用RDB。
假如数据安全要求比较高，需要采用RDB和AOF结合的方式。
不推荐只使用AOF，因为定时生成RDB非常适合数据库备份。且RDB恢复数据也比AOF快，不会产生AOF方式下的bug。
Redis重启会优先从AOF中恢复数据
> ### RDB快照机制
默认情况下RDB将数据保存在名称为dump.rdb的文件中。
Redis可以通过设置 “N秒内至少有M个键发生改动就保存” 条件被满足的时候，执行一次数据集保存。
可以通过SAVE或者BGSAVE主动触发数据集保存操作。

> ### 快照的运作机制  
Redis父进程fork出来一个子进程；  
父进程继续处理客户端操作，子进程将当前数据集写入到一个临时文件中；  
数据集写入完成后，Redis会用这个文件替换老文件，删除老文件
> ### AOF及AOF重写  
当AOF文件变大，Redis会重写AOF文件来优化体积。例如某个键从1累加到99可能是多条命令，
rebuild后会变成一条命令。
Redis还支持不打断Redis服务客户端的情况下进行重建，过程和和RDB类似，利用写时复制策略  
AOF重写机制->  
1）Redis父进程fork子进程  
2）子进程创建临时文件，将原AOF文件内容写入。同时父进程将新产生的命令缓存起来  
3）临时文件写入完成后，父进程将缓存命令追加到临时文件尾部
4）
> ### AOF有多耐久  
* 每次有写命令都执行fsync到磁盘
* 每秒执行fsync 默认（推荐）兼顾效率和数据安全
* 从不执行fsync 不推荐
> ### AOF出错了怎么办？
redis-check-aof可以修复出错的AOF文件

### 4.主从机制
当一个从服务连接到主服务时，会发送SYNC命令给主服务，主服务执行BGSAVE生成 .rdb文件，生成文件期间所有的保存操作将会保存到缓存区。
.rdb文件生成后主服务将这个文件发送给从服务，从服务将这些数据恢复到内存中。之后主服务会将缓存区的命令以Redis协议的方式发送给从服务，
从服务执行这些命令继续恢复数据。

## **MySQL**
索引：
锁机制：
事务：
优化：
扩展性伸缩性：

MongoDB：
索引：
锁机制：
优化：
扩展性伸缩性：


